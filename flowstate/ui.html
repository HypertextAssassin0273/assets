<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>FlowState</title>

<style>
body {
  margin:0;
  padding:10px;
  font-family:system-ui;
  background:#0e0e0e;
  color:#eee;
}

.group {
  display:flex;
  align-items:center;
  margin-bottom:6px;
}

button {
  margin-top:10px;
  width:100%;
  padding:6px;
  background:#2563eb;
  border:none;
  color:white;
  cursor:pointer;
  transition: background 0.15s ease;
}

button:hover:not(:disabled) {
  background:#3b82f6;
}

button:disabled {
  opacity:0.4;
  cursor:not-allowed;
}

#empty, #noop {
  opacity:0.6;
  margin-bottom:10px;
}
</style>
</head>

<body>

<h3>Suspend Groups</h3>

<div id="empty" style="display:none;">No active tab groups found.</div>
<div id="noop" style="display:none;">Groups already suspended.</div>

<div id="groups"></div>

<button id="suspend" disabled>Suspend Selected</button>

<script>
const groupsDiv = document.getElementById("groups");
const emptyMsg = document.getElementById("empty");
const noopMsg = document.getElementById("noop");
const suspendBtn = document.getElementById("suspend");

// Ask popup for groups
window.parent.postMessage({ type:"list-groups" }, "*");

function updateButtonState() {
  const checked = document.querySelectorAll("input:checked").length;
  suspendBtn.disabled = checked === 0;
}

// Receive groups
window.addEventListener("message", e => {

  if (e.data.type === "groups") {
    const { groups, activeGroupId } = e.data;

    groupsDiv.innerHTML = "";
    noopMsg.style.display = "none";

    if (!groups || groups.length === 0) {
      emptyMsg.style.display = "block";
      suspendBtn.disabled = true;
      return;
    }

    emptyMsg.style.display = "none";

    groups.forEach(g => {
      const row = document.createElement("div");
      row.className = "group";
      const checked = g.id === activeGroupId ? "checked" : "";

      row.innerHTML = `
        <input type="checkbox" value="${g.id}" ${checked}>
        <span style="margin-left:6px">${g.title || "(untitled)"}</span>
      `;

      row.querySelector("input").addEventListener("change", updateButtonState);
      groupsDiv.appendChild(row);
    });

    updateButtonState();
  }

  if (e.data.type === "suspend-result") {
    if (!e.data.didWork) {
      noopMsg.style.display = "block";
    } else {
      window.close();
    }
  }
});

// Suspend selected groups
suspendBtn.onclick = () => {
  const ids = [...document.querySelectorAll("input:checked")].map(i => +i.value);
  if (!ids.length) return;
  noopMsg.style.display = "none";
  window.parent.postMessage({ type:"suspend-groups", ids }, "*");
};
</script>

</body>
</html>
